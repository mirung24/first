<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cate">
	
	<!-- 만들어진 카테고리가 있는지 확인 -->
	<select id="cate_check" parameterType="vo.newvo.CateVO" resultType="int">
		select count(*) from pos_chaincategory1 pc where chaincode = #{chaincode}
	</select>
	
	<!-- 카테고리1 리스트 가져오기 -->
	<select id="cate1_list" parameterType="vo.newvo.CateVO" resultType="vo.newvo.CateVO">
		select
			pc.category1cd,
			pc.categoryname,
			pc.remarks,
			pc.useyn,
			pc.ordernum,
			count(pc2.category2cd) as cnt
		from pos_chaincategory1 pc
			left outer join pos_chaincategory2 pc2 
				on pc.chaincode = pc2.chaincode and pc.category1cd = pc2.category1cd 
		where pc.chaincode = #{chaincode}
		group by pc.category1cd, pc.categoryname, pc.remarks, pc.useyn, pc.ordernum
		order by ordernum asc
	</select>
	
	<!-- 카테고리2 리스트 가져오기 -->
	<select id="cate2_list" parameterType="vo.newvo.CateVO" resultType="vo.newvo.CateVO">
		select 
			pc2.category2cd,
			pc2.categoryname,
			pc2.remarks,
			pc2.useyn,
			pc2.ordernum,
			count(pc3.category3cd) as cnt
		from pos_chaincategory2 pc2
			inner join pos_chaincategory1 pc on pc.category1cd = pc2.category1cd
			left outer join pos_chaincategory3 pc3 
				on pc2.chaincode = pc3.chaincode and pc2.category2cd = pc3.category2cd 
		where pc2.category1cd = #{category1cd} and pc2.chaincode = #{chaincode}
		group by pc2.category2cd, pc2.categoryname, pc2.remarks, pc2.useyn, pc2.ordernum
		order by ordernum asc
	</select>
	
	<!-- 카테고리3 리스트 가져오기 -->
	<select id="cate3_list" parameterType="vo.newvo.CateVO" resultType="vo.newvo.CateVO">
		select 
			pc3.category3cd,
			pc3.categoryname,
			pc3.remarks,
			pc3.useyn,
			pc3.ordernum,
			count(pp.category3cd) as cnt
		from pos_chaincategory3 pc3
			inner join pos_chaincategory2 pc2 on pc2.category2cd = pc3.category2cd 
			left outer join pos_chainproduct pp 
				on pc3.chaincode = pp.chaincode and pc3.category3cd = pp.category3cd 
		where pc3.category2cd = #{category2cd} and pc3.chaincode = #{chaincode}
		group by pc3.category3cd, pc3.categoryname, pc3.remarks, pc3.useyn, pc3.ordernum
		order by ordernum asc
	</select>
	
	<!-- 1차 카테고리 사용유무 변경 -->
	<update id="cate1_useyn" parameterType="vo.newvo.CateVO">
		update pos_chaincategory1 set useyn = #{useyn} 
		where chaincode = #{chaincode} and category1cd = #{category1cd}
	</update>
	
	<!-- 2차 카테고리 사용유무 변경 -->
	<update id="cate2_useyn" parameterType="vo.newvo.CateVO">
		update pos_chaincategory2 set useyn = #{useyn} 
		where chaincode = #{chaincode} and category2cd = #{category2cd}
	</update>
	
	<!-- 3차 카테고리 사용유무 변경 -->
	<update id="cate3_useyn" parameterType="vo.newvo.CateVO">
		update pos_chaincategory3 set useyn = #{useyn} 
		where chaincode = #{chaincode} and category3cd = #{category3cd}
	</update>
	
	<!-- 1차 카테고리코드 만들깅 -->
	<select id="cate1_code" resultType="String">
		select fn_getuuid('CA1') as category1cd
	</select>
	
	<!-- 2차 카테고리코드 만들깅 -->
	<select id="cate2_code" resultType="String">
		select fn_getuuid('CA2') as category2cd
	</select>
	
	<!-- 3차 카테고리코드 만들깅 -->
	<select id="cate3_code" resultType="String">
		select fn_getuuid('CA3') as category3cd
	</select>
	
	<!-- 1차 카테고리 추가 -->
	<insert id="cate1_add" parameterType="vo.newvo.CateVO">
		insert into pos_chaincategory1 (
			chaincode,
			category1cd,
			categoryname,
			remarks,
			useyn,
			ordernum
		) values (
			#{chaincode},
			#{category1cd},
			#{categoryname},
			'',
			'Y',
			#{ordernum}
		)
	</insert>
	
	<!-- 2차 카테고리 추가 -->
	<insert id="cate2_add" parameterType="vo.newvo.CateVO">
		insert into pos_chaincategory2 (
			chaincode,
			category2cd,
			category1cd,
			categoryname,
			remarks,
			useyn,
			ordernum
		) values (
			#{chaincode},
			#{category2cd},
			#{category1cd},
			#{categoryname},
			'',
			'Y',
			#{ordernum}
		)
	</insert>
	
	<!-- 3차 카테고리 추가 -->
	<insert id="cate3_add" parameterType="vo.newvo.CateVO">
		insert into pos_chaincategory3 (
			chaincode,
			category3cd,
			category2cd,
			categoryname,
			remarks,
			useyn,
			ordernum
		) values (
			#{chaincode},
			#{category3cd},
			#{category2cd},
			#{categoryname},
			'',
			'Y',
			#{ordernum}
		)
	</insert>
	
	<!-- 1차 카테고리 수정 -->
	<update id="cate1_modi" parameterType="vo.newvo.CateVO">
		update pos_chaincategory1 set categoryname = #{categoryname}
		where category1cd = #{category1cd} and chaincode = #{chaincode}
	</update>
	
	<!-- 2차 카테고리 수정 -->
	<update id="cate2_modi" parameterType="vo.newvo.CateVO">
		update pos_chaincategory2 set
			category1cd = #{category1cd},
			categoryname = #{categoryname}
		where category2cd = #{category2cd} and chaincode = #{chaincode}
	</update>
	
	<!-- 3차 카테고리 수정 -->
	<update id="cate3_modi" parameterType="vo.newvo.CateVO">
		update pos_chaincategory3 set
			category2cd = #{category2cd},
			categoryname = #{categoryname}
		where category3cd = #{category3cd} and chaincode = #{chaincode}
	</update>
	
	<!-- 1차 카테고리 순서변경 -->
	<update id="cate1_numC" parameterType="vo.newvo.CateVO">
		update pos_chaincategory1 set ordernum = #{Cordernum} 
		where category1cd = #{Ccategory1cd} and chaincode = #{chaincode}
	</update>
	
	<!-- 2차 카테고리 순서변경 -->
	<update id="cate2_numC" parameterType="vo.newvo.CateVO">
		update pos_chaincategory2 set ordernum = #{Cordernum} 
		where category2cd = #{Ccategory2cd} and chaincode = #{chaincode}
	</update>
	
	<!-- 3차 카테고리 순서변경 -->
	<update id="cate3_numC" parameterType="vo.newvo.CateVO">
		update pos_chaincategory3 set ordernum = #{Cordernum} 
		where category3cd = #{Ccategory3cd} and chaincode = #{chaincode}
	</update>
	
	<!-- 올댓페이 1차 카테고리 리스트 -->
	<select id="at_cate1" parameterType="vo.newvo.CateVO" resultType="vo.newvo.CateVO">
		select
			pc.category1cd,
			pc.categoryname,
			pc.remarks,
			pc.useyn,
			pc.ordernum,
			count(pc2.category2cd) as cnt
		from pos_category1 pc
			left outer join pos_category2 pc2 
				on pc.category1cd = pc2.category1cd
		group by pc.category1cd, pc.categoryname, pc.remarks, pc.useyn, pc.ordernum
		order by ordernum asc
	</select>
	
	<!-- 올댓페이 2차 카테고리 리스트 -->
	<select id="at_cate2" parameterType="vo.newvo.CateVO" resultType="vo.newvo.CateVO">
		select
			pc2.category2cd,
			pc2.categoryname,
			pc2.remarks,
			pc2.useyn,
			pc2.ordernum,
			count(pc3.category3cd) as cnt
		from pos_category2 pc2
			inner join pos_category1 pc on pc.category1cd = pc2.category1cd
			left outer join pos_category3 pc3 
				on pc2.category2cd = pc3.category2cd 
		where pc2.category1cd = #{category1cd}
		group by pc2.category2cd, pc2.categoryname, pc2.remarks, pc2.useyn, pc2.ordernum
		order by ordernum asc
	</select>
	
	<!-- 올댓페이 3차 카테고리 리스트 -->
	<select id="at_cate3" parameterType="vo.newvo.CateVO" resultType="vo.newvo.CateVO">
		select
			pc3.category2cd,
			pc3.categoryname,
			pc3.remarks,
			pc3.useyn,
			pc3.ordernum
		from pos_category3 pc3
			inner join pos_category2 pc2 on pc2.category2cd = pc3.category2cd
		where pc3.category2cd = #{category2cd}
		group by pc3.category2cd, pc3.categoryname, pc3.remarks, pc3.useyn, pc3.ordernum
		order by ordernum asc
	</select>
	
	<!-- 올댓 카테고리 사용하기 1차 -->
	<insert id="use1" parameterType="vo.newvo.CateVO">
		insert into pos_chaincategory1 
		(chaincode, category1cd, categoryname, remarks, useyn, ordernum)
		select 
			#{chaincode},
			category1cd, 
			categoryname, 
			remarks, 
			useyn, 
			ordernum 
		from pos_category1
	</insert>
	
	<!-- 올댓 카테고리 사용하기 2차 -->
	<insert id="use2" parameterType="vo.newvo.CateVO">
		insert into pos_chaincategory2 
		(chaincode, category2cd, category1cd, categoryname, remarks, useyn, ordernum)
		select 
			#{chaincode},
			category2cd,
			category1cd, 
			categoryname, 
			remarks, 
			useyn, 
			ordernum
		from pos_category2
	</insert>
	
	<!-- 올댓 카테고리 사용하기 3차 -->
	<insert id="use3" parameterType="vo.newvo.CateVO">
		insert into pos_chaincategory3 
		(chaincode, category3cd, category2cd, categoryname, remarks, useyn, ordernum)
		select
			#{chaincode},
			category3cd,
			category2cd,
			categoryname,
			remarks,
			useyn,
			ordernum
		from pos_category3
	</insert>
</mapper>












