<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com">
	
	<!-- 사용자 추가 리스트 (대표, 사원)/카드사명 selectbox /과세 select-->
	<select id="com_select" parameterType="vo.CodeVO" resultType="vo.CodeVO">
		select code, codename
		from pos_code 
		where upcode=#{upcode} and useyn='Y'
	</select>
	
	<!-- 거래처 리스트 가져오기 select -->
	<select id="com_account" parameterType="vo.shopvo.AccountVO" resultType="vo.shopvo.AccountVO">
		SELECT 
			accountcd,
			accountname,
			replace(corporatenumber, '-','') as corporatenumber,
			president, 
			manager, 
			email, 
			tel, 
			concat(address,' ',address2) as addr, 
			business, 
			sectors 
		from pos_account 
		where compcd = #{compcd}
	</select>
	
	<!-- 로고 이미지 경오 가져오기(가맹점) -->
	<select id="logoImg" parameterType="String" resultType="String">
		select logo from pos_chainuser pc 
		where pc.chaincd = (select chaincode from pos_chaincompany pc 
		where pc.compcd = (select compcd from pos_companyuser pc 
		where pc.userid = #{regcd}))
	</select>
	
	<!-- 로고 이미지 경오 가져오기(체인점) -->
	<select id="logoImg2" parameterType="String" resultType="String">
		select logo from pos_chainuser pc where pc.userid = #{regcd}
	</select>
	
	<!-- temp에 있는 해당 가맹점 데이터 지우기 -->
	<delete id="temp_delete" parameterType="String">
		delete from pos_payment_temp where compcd = #{compcd}
	</delete>
	
	<!-- temp 테이블에 api로 받은 데이터 집어넣기 -->
	<insert id="temp_insert" parameterType="java.util.Map">
		insert into pos_payment_temp (
			compcd, paymentcd, paymethod, auth_no, auth_date, auth_time, org_auth_no, org_auth_date, org_auth_time,
			paygubn, card, money, amt, vat, total, discount, money_no, prescription_no, cardgubn, installments, salesid,
			name, birthday, sex, hp, tid, productnames, cardno, etcamt, auth_ti, trans_filler, vancd, regdt, upddt
		) values(
			#{compcd}, #{paymentcd}, #{paymethod},
			#{res_apprveNo}, #{res_tranDt}, #{res_tranTm}, null, #{res_orgTranDt}, null, #{paygubn}, null, null, #{res_otcAmt},
			#{res_taxAmt}, #{res_tranAmt}, null, null, null, #{res_mCardCode}, #{res_install}, null, #{name}, null, null, null, #{res_tid},
			null, #{res_cardNo}, #{res_etcAmt}, #{auth_ti}, #{res_filler}, 'V01', now(), null
		)
	</insert>
	
	<!-- paymentcd가 중복된 애들 지우깅-->
	<delete id="dupli_del" parameterType="String">
		delete from pos_payment_temp where (compcd,paygubn,auth_no,auth_date,auth_time,total)
		in(
		   select compcd,paygubn,auth_no,auth_date,auth_time,total
		   from pos_payment where compcd=#{compcd} and auth_date between date_format(adddate(now(), interval -1 month),'%Y%m%d') and date_format(now(),'%Y%m%d')
		)
	</delete>
	
	<!-- y,n 유무에 따라 보이기/숨기기 설정 -->
	<select id="connectyn" parameterType="String" resultType="String">
		select connectyn from pos_company pc where compcd = #{compcd}
	</select>
	
</mapper>












